<mat-card class="filters-card">
  <mat-card-header class="filters-header">
    <mat-card-title>Filters</mat-card-title>
    <button
      mat-icon-button
      (click)="toggleExpand()"
      [attr.aria-expanded]="isExpanded"
      class="expand-btn"
    >
      <mat-icon [class.expanded]="isExpanded">expand_more</mat-icon>
    </button>
  </mat-card-header>

  <div [@.disabled]="isExpanded" *ngIf="isExpanded" class="filters-content">
    <form [formGroup]="filterForm" (ngSubmit)="onSubmit()">
      <!-- Date Range Section -->
      <fieldset formGroupName="dateRange" class="filter-group">
        <legend class="filter-legend">Date Range</legend>

        <div class="date-inputs">
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Start Date</mat-label>
            <input
              matInput
              type="date"
              formControlName="dateFrom"
              [disabled]="isLoading"
            />
            <mat-error
              *ngIf="
                dateRangeGroup.get('dateFrom')?.hasError('required')
              "
            >
              Start date is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="date-field">
            <mat-label>End Date</mat-label>
            <input
              matInput
              type="date"
              formControlName="dateTo"
              [disabled]="isLoading"
            />
            <mat-error
              *ngIf="
                dateRangeGroup.get('dateTo')?.hasError('required')
              "
            >
              End date is required
            </mat-error>
          </mat-form-field>
        </div>
      </fieldset>

      <!-- Entity Filters Section -->
      <fieldset class="filter-group">
        <legend class="filter-legend">Entities</legend>

        <div class="filter-inputs">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>User ID</mat-label>
            <input
              matInput
              type="number"
              formControlName="userId"
              placeholder="Optional"
              [disabled]="isLoading"
            />
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Clinic ID</mat-label>
            <input
              matInput
              type="number"
              formControlName="clinicId"
              placeholder="Optional"
              [disabled]="isLoading"
            />
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Patient ID</mat-label>
            <input
              matInput
              type="number"
              formControlName="patientId"
              placeholder="Optional"
              [disabled]="isLoading"
            />
          </mat-form-field>
        </div>
      </fieldset>

      <!-- Consent & Search Section -->
      <fieldset class="filter-group">
        <legend class="filter-legend">Additional Filters</legend>

        <div class="filter-inputs">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Has Valid Consent</mat-label>
            <mat-select formControlName="hasConsent" [disabled]="isLoading">
              <mat-option value="">All</mat-option>
              <mat-option value="true">Yes</mat-option>
              <mat-option value="false">No</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Search (Purpose/Notes)</mat-label>
            <input
              matInput
              type="text"
              formControlName="searchTerm"
              placeholder="Optional"
              [disabled]="isLoading"
            />
          </mat-form-field>
        </div>
      </fieldset>

      <!-- Action Buttons -->
      <div class="filter-actions">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!isFormValid || isLoading"
          class="apply-btn"
        >
          <mat-icon>search</mat-icon>
          Apply Filters
        </button>

        <button
          mat-stroked-button
          type="button"
          (click)="onReset()"
          [disabled]="isLoading"
          class="reset-btn"
        >
          <mat-icon>refresh</mat-icon>
          Reset Filters
        </button>
      </div>
    </form>
  </div>
</mat-card>
